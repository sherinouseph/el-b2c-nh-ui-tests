<html>
<head>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>-->
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load("visualization", "1", {packages:["corechart"]});
        google.setOnLoadCallback(drawChart);
        function getChartData()  {
            var chartData;
            chartData = new google.visualization.DataTable();
            var buildColumnIndex = chartData.addColumn('string', 'Build Number');
            var columnMap = {};
            <!-- var projectUrl = "/httpAuth/app/rest/buildTypes/id:B2C_QA_StandardTests/builds?status=SUCCESS" -->
            <!--var projectUrl "http:teamcity.englishtown.com/httpAuth/app/rest/buildTypes/id:B2CQA_LiveSmokeTest_LiveSmokeTestChrom/"; -->
            <!-- http:\/\/teamcity.englishtown.com/viewType.html?buildTypeId=B2CQA_LiveSmokeTest_LiveSmokeTestChrom"; -->
            <!-- -->

            var projectUrl =  "/httpAuth/app/rest/buildTypes/id:B2CQA_LiveTimingsChrome/builds?status=SUCCESS";
                    <!--"http:\/\/teamcity.englishtown.com/viewLog.html?buildId=79822&tab=buildResultsDiv&buildTypeId=B2CQA_LiveSmokeTest_LiveSmokeTestChrom"; -->

            jQuery.ajax({dataType:"json",url:projectUrl,async:false}).done(
                    function(projectData) {
                        projectData.build.forEach(
                                function(buildData){
                                    var timingsArtifactUrl = "/httpAuth/app/rest/builds/id:" + buildData.id + "/artifacts/content/pageLoadTimes.json";
                                    jQuery.ajax({
                                        dataType : "json",
                                        url: timingsArtifactUrl,
                                        async:false
                                    }).done(
                                            function(timingData) {
                                                var rowIndex = chartData.addRow();
                                                chartData.setValue(rowIndex, buildColumnIndex, buildData.id.toString());
                                                timingData.statistics.forEach(
                                                        function(s) {
                                                            var key = s.url;
                                                            var value = s.loadTime;
                                                            if(columnMap[key] === undefined) {
                                                                columnMap[key] = chartData.addColumn('number', key);
                                                                console.log("added column: " + key);
                                                            }
                                                            var columnIndex = columnMap[key];
                                                            chartData.setValue(rowIndex, columnIndex, value);
                                                        });
                                            });
                                })
                    });
            return chartData;
        }

        function drawChart() {
            var options = {
                title: 'Page Load Times (seconds)'
            };
            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));
            chart.draw(getChartData(), options);
        }
    </script>
</head>
<body>
<div id="chart_div" style="width: 900px; height: 500px;"></div>
</body>
</html>